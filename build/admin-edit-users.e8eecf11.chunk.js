"use strict";(self.webpackChunkblog_backend=self.webpackChunkblog_backend||[]).push([[4263],{50935:(T,l,e)=>{e.d(l,{R:()=>c});var t=e(88767),a=e(87631),s=e(80129);function c(o={},u={}){const{id:n="",...m}=o,i=(0,s.stringify)(m,{encode:!1}),{get:d}=(0,a.kY)(),{data:r,isError:y,isLoading:I,refetch:L}=(0,t.useQuery)(["users",n,m],async()=>{const{data:{data:A}}=await d(`/admin/users/${n}${i?`?${i}`:""}`);return A},u);let v=[];return n&&r?v=[r]:Array.isArray(r?.results)&&(v=r.results),{users:v,pagination:r?.pagination??null,isLoading:I,isError:y,refetch:L}}},22282:(T,l,e)=>{e.r(l),e.d(l,{default:()=>pe});var t=e(67294),a=e(87631),s=e(16550),c=e(87751),o=e(87462),u=e(15861),n=e(70885),m=e(64687),i=e.n(m),d=e(86896),r=e(45697),y=e.n(r),I=e(78718),L=e.n(I),v=e(27361),A=e.n(v),Z=e(57557),C=e.n(Z),w=e(14916),F=e(185),N=e(53979),j=e(29728),D=e(49066),W=e(41580),K=e(11047),H=e(75515),X=e(11276),Y=e(74571),M=e(85018),_=e(67109),Q=e(19631);const ie=async(S,z)=>{const{put:O}=(0,a.tg)(),{data:R}=await O(`/admin/users/${S}`,z);return R.data},de=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]];var ce=e(17405),Ue=e(81288),me=e(50935),ue=function(){return window&&window.strapi&&window.strapi.isEE?e(12201).Z:e(31605).Z}(),q=["email","firstname","lastname","username","isActive","roles"],ee=function(z){var O=z.canUpdate,R=(0,d.Z)(),g=R.formatMessage,J=(0,s.$B)("/settings/users/:id"),$=J.params.id,Ee=(0,s.k6)(),fe=Ee.push,ve=(0,a.L7)(),Me=ve.setUserDisplayName,G=(0,a.lm)(),te=(0,a.o1)(),he=te.lockApp,Pe=te.unlockApp;(0,a.go)();var ae=(0,me.R)({id:$},{onError:function(P){var E=P.response.status;E===403?(G({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),fe("/")):G({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),ye=(0,n.Z)(ae.users,1),h=ye[0],se=ae.isLoading,Le=function(){var p=(0,u.Z)(i().mark(function P(E,B){var x,b,U,k,re;return i().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return he(),f.prev=1,f.next=4,ie($,C()(E,"confirmPassword"));case 4:x=f.sent,G({type:"success",message:g({id:"notification.success.saved",defaultMessage:"Saved"})}),b=a.I8.getUserInfo(),$.toString()===b.id.toString()&&(a.I8.setUserInfo(x),U=A()(E,"username")||(0,Q.Pp)(E.firstname,E.lastname),Me(U)),B.setValues(L()(E,q)),f.next=17;break;case 11:f.prev=11,f.t0=f.catch(1),k=(0,Q.Iz)(f.t0.response.data),re=Object.keys(k).reduce(function(oe,le){return oe[le]=k[le].id,oe},{}),B.setErrors(re),G({type:"warning",message:A()(f.t0,"response.data.error.message","notification.error")});case 17:Pe();case 18:case"end":return f.stop()}},P,null,[[1,11]])}));return function(E,B){return p.apply(this,arguments)}}(),Ae=se?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},V=Object.keys(L()(h,q)).reduce(function(p,P){return P==="roles"?(p[P]=(h?.roles||[]).map(function(E){var B=E.id;return B}),p):(p[P]=h?.[P],p)},{}),De=V.username||(0,Q.Pp)(V.firstname,V.lastname),ne=g(Ae,{name:De});return se?t.createElement(F.o,{"aria-busy":"true"},t.createElement(a.SL,{name:"Users"}),t.createElement(N.T,{primaryAction:t.createElement(j.z,{disabled:!0,startIcon:t.createElement(M.Z,null),type:"button",size:"L"},g({id:"global.save",defaultMessage:"Save"})),title:ne,navigationAction:t.createElement(a.rU,{startIcon:t.createElement(_.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},g({id:"global.back",defaultMessage:"Back"}))}),t.createElement(D.D,null,t.createElement(a.dO,null))):t.createElement(F.o,null,t.createElement(a.SL,{name:"Users"}),t.createElement(w.J9,{onSubmit:Le,initialValues:V,validateOnChange:!1,validationSchema:ce.YM},function(p){var P=p.errors,E=p.values,B=p.handleChange,x=p.isSubmitting;return t.createElement(a.l0,null,t.createElement(N.T,{primaryAction:t.createElement(j.z,{disabled:x||!O,startIcon:t.createElement(M.Z,null),loading:x,type:"submit",size:"L"},g({id:"global.save",defaultMessage:"Save"})),title:ne,navigationAction:t.createElement(a.rU,{startIcon:t.createElement(_.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},g({id:"global.back",defaultMessage:"Back"}))}),t.createElement(D.D,null,h?.registrationToken&&t.createElement(W.x,{paddingBottom:6},t.createElement(ue,{registrationToken:h.registrationToken})),t.createElement(K.k,{direction:"column",alignItems:"stretch",gap:7},t.createElement(W.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(K.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(H.Z,{variant:"delta",as:"h2"},g({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement(X.r,{gap:5},de.map(function(b){return b.map(function(U){return t.createElement(Y.P,(0,o.Z)({key:U.name},U.size),t.createElement(a.jm,(0,o.Z)({},U,{disabled:!O,error:P[U.name],onChange:B,value:E[U.name]||""})))})})))),t.createElement(W.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(K.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(H.Z,{variant:"delta",as:"h2"},g({id:"global.roles",defaultMessage:"User's role"})),t.createElement(X.r,{gap:5},t.createElement(Y.P,{col:6,xs:12})))))))}))};ee.propTypes={canUpdate:y().bool.isRequired};const ge=ee,pe=()=>{const S=(0,a.lm)(),z=(0,t.useMemo)(()=>({read:c.Z.settings.users.read,update:c.Z.settings.users.update}),[]),{isLoading:O,allowedActions:{canRead:R,canUpdate:g}}=(0,a.ss)(z),{state:J}=(0,s.TH)(),$=J?.from??"/";return(0,t.useEffect)(()=>{O||!R&&!g&&S({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[O,R,g,S]),O?t.createElement(a.dO,null):!R&&!g?t.createElement(s.l_,{to:$}):t.createElement(ge,{canUpdate:g})}},82464:(T,l,e)=>{e.d(l,{Z:()=>i});var t=e(67294),a=e(45697),s=e.n(a),c=e(12028),o=e(87631),u=e(65186),n=e(86896);const m=({children:d,target:r})=>{const y=(0,o.lm)(),{formatMessage:I}=(0,n.Z)(),{copy:L}=(0,o.VP)(),v=I({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),A=async()=>{await L(r)&&y({type:"info",message:{id:"notification.link-copied"}})};return t.createElement(o.Y_,{endAction:t.createElement(c.h,{label:v,noBorder:!0,icon:t.createElement(u.Z,null),onClick:A}),title:r,titleEllipsis:!0,subtitle:d,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};m.propTypes={children:s().oneOfType([s().element,s().string]).isRequired,target:s().string.isRequired};const i=m},31605:(T,l,e)=>{e.d(l,{Z:()=>m});var t=e(67294),a=e(86896),s=e(45697),c=e.n(s),o=e(63871),u=e(82464);const n=({registrationToken:i})=>{const{formatMessage:d}=(0,a.Z)(),r=`${window.location.origin}${o.Z}auth/register?registrationToken=${i}`;return t.createElement(u.Z,{target:r},d({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};n.defaultProps={registrationToken:""},n.propTypes={registrationToken:c().string};const m=n},81288:(T,l,e)=>{e.d(l,{Z:()=>A});var t=e(67294),a=e(45697),s=e.n(a),c=e(86896),o=e(40619),u=e(82562),n=e(88767),m=e(71997),i=e(86647),d=e(87631);const r=m.F4`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,y=m.ZP.div`
  animation: ${r} 2s infinite linear;
`,I=()=>t.createElement(y,null,t.createElement(i.Z,null)),L=async()=>{const{get:Z}=(0,d.tg)(),{data:C}=await Z("/admin/roles");return C.data},v=({disabled:Z,error:C,onChange:w,value:F})=>{const{status:N,data:j}=(0,n.useQuery)(["roles"],L,{staleTime:5e4}),{formatMessage:D}=(0,c.Z)(),W=C?D({id:C,defaultMessage:C}):"",K=D({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),H=D({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),X=D({id:"app.components.Select.placeholder",defaultMessage:"Select"}),Y=N==="loading"?t.createElement(I,null):void 0;return t.createElement(o.P,{id:"roles",disabled:Z,error:W,hint:H,label:K,name:"roles",onChange:M=>{w({target:{name:"roles",value:M}})},placeholder:X,multi:!0,startIcon:Y,value:F.map(M=>M.toString()),withTags:!0,required:!0},(j||[]).map(M=>t.createElement(u.W,{key:M.id,value:M.id.toString()},D({id:`global.${M.code}`,defaultMessage:M.name}))))};v.defaultProps={disabled:!1,error:void 0},v.propTypes={disabled:s().bool,error:s().string,onChange:s().func.isRequired,value:s().array.isRequired};const A=v},17405:(T,l,e)=>{e.d(l,{YM:()=>i,Rw:()=>o});var t=e(87561),a=e(87631);const s={firstname:t.Z_().trim().required(a.I0.required),lastname:t.Z_(),email:t.Z_().email(a.I0.email).lowercase().required(a.I0.required),username:t.Z_().nullable(),password:t.Z_().min(8,a.I0.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.Z_().min(8,a.I0.minLength).oneOf([t.iH("password"),null],"components.Input.error.password.noMatch").when("password",(d,r)=>d?r.required(a.I0.required):r)},o={...s,currentPassword:t.Z_().when(["password","confirmPassword"],(d,r,y)=>d||r?y.required(a.I0.required):y),preferedLanguage:t.Z_().nullable()},n={roles:t.IX().min(1,a.I0.required).required(a.I0.required)},i=t.Ry().shape({...s,isActive:t.Xg(),...n})},12201:(T,l,e)=>{e.d(l,{Z:()=>m});var t=e(67294),a=e(86896),s=e(45697),c=e.n(s),o=e(63871),u=e(82464);const n=({registrationToken:i})=>{const{formatMessage:d}=(0,a.Z)();return i?t.createElement(u.Z,{target:`${window.location.origin}${o.Z}auth/register?registrationToken=${i}`},d({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):t.createElement(u.Z,{target:`${window.location.origin}${o.Z}auth/login`},d({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};n.defaultProps={registrationToken:""},n.propTypes={registrationToken:c().string};const m=n},67109:(T,l,e)=>{e.d(l,{Z:()=>s});var t=e(85893);const a=c=>(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...c,children:(0,t.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),s=a}}]);
